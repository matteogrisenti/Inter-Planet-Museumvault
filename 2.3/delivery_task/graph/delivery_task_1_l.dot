digraph HTN_Staffetta_Parte1_Centrata_Definitiva {
    // Impostazioni originali
    size="8.3,11.7";
    margin=0.2;
    ratio=compress;
    rankdir=TD;
    nodesep=0.15;
    ranksep=0.3;
    splines=polyline;

    // --- Definizione Stili Globali ---
    node [fontname="Helvetica", fontsize=9, margin="0.05,0.05"];
    edge [arrowsize=0.6, color="#555555"];

    // =======================================================
    // ROOT TASK & METHOD (Bloccati al centro)
    // =======================================================
    // Aggiunto group="center" per forzare l'allineamento verticale
    t1 [label="Task:\ndelivery(technician,\nquantum-chip, hall-b,\nmaintenance-tunnel)", shape=box, style=filled, fillcolor="#d9ead3", group="center"];
    
    m_del_1 [label="Method:\nm_delivery_direct", shape=ellipse, style=filled, fillcolor="#fff2cc", group="center"];
    
    t1 -> m_del_1;

    // RAMI DEL PRIMO LIVELLO
    t1_1 [label="Task:\nprepare_robot(technician,\nentrance, hall-b)", shape=box, style=filled, fillcolor="#d9ead3"];
    
    // Anche qui group="center" per allinearlo esattamente sotto la radice
    t1_2 [label="Task:\nload_artifact(technician,\nquantum-chip, hall-b)", shape=box, style=filled, fillcolor="#d9ead3", group="center"];
    
    t1_3 [label="Task:\ntransport_to_target(technician,\nquantum-chip, hall-b,\nmaintenance-tunnel)", shape=box, style=filled, fillcolor="#d9ead3"];
    
    // --- IL CONTRAPPESO INVISIBILE ---
    // Questo nodo non si vede, ma occupa spazio a destra bilanciando il diagramma
    dummy_right [style=invis, width=4, label=""];

    m_del_1 -> t1_1;
    m_del_1 -> t1_2 [weight=10]; // Il peso 10 aiuta a tenere dritta la linea
    m_del_1 -> t1_3;
    m_del_1 -> dummy_right [style=invis]; // Colleghiamo il contrappeso

    // --- T1.1 Prepare Robot ---
    m_prep_1 [label="Method:\nm_prep_fetch_pod", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_1 -> m_prep_1;

    t1_1_1 [label="Task:\nget_to(technician,\nentrance, anti-vib-room)", shape=box, style=filled, fillcolor="#d9ead3"];
    a1_1_2 [label="Action:\npick-up-pod-slot-1\n(technician, anti-vib-room, pod1)", shape=box, style=filled, fillcolor="#c9daf8"];
    t1_1_3 [label="Task:\nget_to(technician,\nanti-vib-room, hall-b)", shape=box, style=filled, fillcolor="#d9ead3"];
    
    m_prep_1 -> t1_1_1;
    m_prep_1 -> a1_1_2;
    m_prep_1 -> t1_1_3;

    // Espansione T1.1.1 (get_to entrance -> anti-vib-room)
    m_get_1 [label="Method:\nm_get_to_transit", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_1_1 -> m_get_1;
    t1_1_1_1 [label="Task:\nstep(technician,\nentrance, maint-tunnel)", shape=box, style=filled, fillcolor="#d9ead3"];
    t1_1_1_2 [label="Task:\nstep(technician,\nmaint-tunnel, anti-vib-room)", shape=box, style=filled, fillcolor="#d9ead3"];
    m_get_1 -> t1_1_1_1;
    m_get_1 -> t1_1_1_2;

    m_step_u1 [label="Method:\nm_step_unpressurized", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_1_1_1 -> m_step_u1;
    a1_1_1_1_1 [label="Action:\nactivate-seal(technician)", shape=box, style=filled, fillcolor="#c9daf8"];
    a1_1_1_1_2 [label="Action:\nmove-unpressurized(technician,\nentrance, maint-tunnel)", shape=box, style=filled, fillcolor="#c9daf8"];
    m_step_u1 -> a1_1_1_1_1;
    m_step_u1 -> a1_1_1_1_2;

    m_step_p1 [label="Method:\nm_step_pressurized", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_1_1_2 -> m_step_p1;
    a1_1_1_2_1 [label="Action:\nmove-pressurized(technician,\nmaint-tunnel, anti-vib-room)", shape=box, style=filled, fillcolor="#c9daf8"];
    m_step_p1 -> a1_1_1_2_1;

    // Espansione T1.1.3 (get_to anti-vib-room -> hall-b)
    m_get_2 [label="Method:\nm_get_to_transit", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_1_3 -> m_get_2;
    t1_1_3_1 [label="Task:\nstep(technician,\nanti-vib-room, maint-tunnel)", shape=box, style=filled, fillcolor="#d9ead3"];
    t1_1_3_2 [label="Task:\nstep(technician,\nmaint-tunnel, hall-b)", shape=box, style=filled, fillcolor="#d9ead3"];
    m_get_2 -> t1_1_3_1;
    m_get_2 -> t1_1_3_2;

    m_step_u2 [label="Method:\nm_step_unpressurized", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_1_3_1 -> m_step_u2;
    a1_1_3_1_1 [label="Action:\nactivate-seal(technician)", shape=box, style=filled, fillcolor="#c9daf8"];
    a1_1_3_1_2 [label="Action:\nmove-unpressurized(technician,\nanti-vib-room, maint-tunnel)", shape=box, style=filled, fillcolor="#c9daf8"];
    m_step_u2 -> a1_1_3_1_1;
    m_step_u2 -> a1_1_3_1_2;

    m_step_s1 [label="Method:\nm_step_seismic", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_1_3_2 -> m_step_s1;
    a1_1_3_2_1 [label="Action:\nwait-seismic-room-safe(technician,\nhall-b, maint-tunnel)", shape=box, style=filled, fillcolor="#c9daf8"];
    m_step_s1 -> a1_1_3_2_1;

    // --- T1.2 Load Artifact ---
    m_load_1 [label="Method:\nm_load_into_pod", shape=ellipse, style=filled, fillcolor="#fff2cc"];
    t1_2 -> m_load_1;
    a1_2_1 [label="Action:\nput-in-pod(quantum-chip,\ntechnological, hall-b,\ntechnician, pod1)", shape=box, style=filled, fillcolor="#c9daf8"];
    m_load_1 -> a1_2_1;
}